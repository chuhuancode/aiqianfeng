# AXF

## 需求分析
>* 项目包含了四大模块
>* 模块包含 首页，闪送，购物车，我的
>* 用户模块可以优先开发，他不和其余有重合区域
>* 首页展示数据，闪送级联数据和其它模块也不耦合，也可以优先开发
>* 购物车需要商品数据和用户信息，购物车要放到最后去做

## 下手项目
>* 新建项目，配置通用选项
>* 划分模块，需要根据规模考虑
>* 分析页面共性，创建基类，基模板
>* 细化深入完成页面

## HTML中细节
>* 我们通常在移动端使用rem单位
>* 创建一个基类的JS，获取屏幕宽度，分成10份

### 项目起点
>* 创建一个Project
>* 配置模板，配置静态文件，配置语言，时区，配置数据库
>* 创建一个app，在urls中注册app

#### 页面管理
>* 观察主页面，观察主页面的结构，提取通用部分
>* 创建基模板，配置项目通用资源,JS,CSS,IMG，FONT
>* 创建一个基模板，引入全局通用的资源，JS，CSS
>* 为后续页面挖坑，留给后续页面进行填充

### 页面创建
>* 基模板
>* 模块模板(main)
>* 细节模板 home( extends main),引入个性化资源


### 展示模板
>* 配置路由，配置视图函数
>* 主页面展示

### 真实数据的获取加载
>* 模型开始开发
>* 分析数据字段
>* 建立模型

###


### 个人中心
>* 登录
>* 注册
>* 退出
>* 信息安全
>* ajax

#### 注册
>* 使用form和服务器进行通信
>* 文件（头像），enctype='multipart/form-data'
>* {% csrf_token %}
>* 注册前验证 
    - 使用ajax和服务器进行异步通信
    - ajax使用绝大部分传输的都是json格式
    - 使用get请求，post在django需要验证csrf_token
    - $.getJson(url,data,funtion(data))   请求中的data就是字典结构的请求参数，返回的data在ajax会自动转换成字典，对象
    - 密码验证，在form表单中添加 onsubmit='return boolean‘ ，boolean支持函数，true提交通过，false提交失败

#### 注册后自动登录
>* 使用会话实现页面关联数据
>* cookie,session,token
>* cookie 客户端技术，存在浏览器中，session 服务器技术，django中存储在数据库中，token和session完全一样
>* 请求返回的时候，设置token，请求过来的时候验证token，拿token去取数据
>* session，请求返回自动设置cookie中的sessionid，请求进来的进来时候操作 session

#### 退出
>* 清除令牌，删除cookie
>* 清除数据，清理session

####登录
>* 将数据从客户端传递到服务器
>* 服务器验证

#### 数据安全
>* 肯定使用加密算法，摘要算法（hashlib，MD5）
>* md5 不管输入是多少，输出都是128的二进制，32位16进制，转换成32位的字符串
>* 第一层，从客户端接收的数据做了一次md5， 防止开发人员
>* 第二层，使用js实现md5，防止抓包，不能直接知道密码

#### nginx安装
>* linux 
    - 源码安装
    - 安装包安装
    - 包管理工具安装
        - 定义对自己的包
           - apt-key add xxx 添加签名密钥（public key），RSA(非对称加密)
           - 将deb src添加到source.list中
           - apt update,apt install xxx
           
   
#### 购物车 (用表关系来说)
>* 购物车数据表（一行数据代表一个商品信息）
    - 商品id（多对一）
    - 用户id（多对一）
    - 商品数量
    - 商品是否选中
    - 订单id（多对一）
    
>* 订单数据表（一行数据代表一个订单）
    - 用户id（多对一）
    - 商品（和购物车数据表进行关联）
    - 订单状态
    
# 闪购
>* 点击添加
>* 将商品id发送给服务器
>* 服务器要判断是否登录，如果没登录，可以跳转到登录页面
>* 如果登录了，就将数据添加到购物车

## 购物车思路
>* 购物车表
    - 用户id
    - 商品id
    - 商品num
    - 归属（属于购物车，还是属于订单）
    - 属于订单时的外键（没有的时候为null）
    
>* 订单表
    - 用户id
    - 状态status
    - 下单时间
    - 优惠信息
    - 付款时间
    - 收货时间
    - 评价时间
    
## 数据流转  
>* 将数据添加到购物车
    - 将点击的商品的id传递给服务器
    - 判断用户是否登录，未登录就跳转到登录界面 
    - 获取登录用户信息，获取商品信息
    - 去购物车中查找是否包含已有商品
    - 没有的话直接创建，存在的商品直接数量加1
    - 数据变更完成返回给前端，前端做页面的数据变换
 
>* 购物车数据展示
    - 根据用户去购物车表中查找
    - 购物车中的商品是否处于选中状态
    - 根据标记设置前端是否显示选中标记
    - 点击标记的时候和服务器进行通信，同步数据变更
    - 服务器返回之后，根据结果进行差量更新
    
>* 订单生成
    - 在点击下单的时候，将选中的所有商品id传递给服务器
    - 服务器生成新的订单，将订单的主键传递给购物车表中数据
    - 变更购物车表中数据的所属关系
